
project(library)
cmake_minimum_required(VERSION 2.8)

include( ${PROJECT_SOURCE_DIR}/OpenLibrary.cmake )
include( ${PROJECT_SOURCE_DIR}/cmake/functions.cmake )
include( ${PROJECT_SOURCE_DIR}/cmake/cmake_tests.cmake )
set(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)

#prepare target for autogenerated files, and for running tests
add_custom_target(autogenerated)           #all generated files (which will rarely change) used for futher compilation should attach here (like flex/bison c/h files, images (svg->png) etc)
add_custom_target(test)                    #all internal test targets should attach here

#prepare target for cration of cmake variables for each sub-library of OpenLibrary
generate_variables_file()

#clean some internal variables
unset(OPENLIBRARY_REGISTERED_LIBRARIES CACHE)
unset(OPENLIBRARY_REGISTERED_LIBRARY_TARGETS CACHE)

#generate file with export/import stuff for sublibraries
prepareExportFile(${CMAKE_SOURCE_DIR}/src/OpenLibraryExports.hpp)

add_subdirectory(src/htmlParser htmlParser)
#add_subdirectory(qextserialport qextserialport)
add_subdirectory(src/router router)
add_subdirectory(src/QtExt QtExt)
add_subdirectory(src/utils utils)
add_subdirectory(src/math math)

set(LIBRARY_HEADERS src/debug.hpp src/std_macros.hpp src/str_op.hpp)

register_library(common HEADERS ${LIBRARY_HEADERS} SOURCES src/str_op.cpp)

#create cmake tests
runTests()
